<div class="add-restaurant container-fluid">
  <div class="add-restaurant-content card card-container">
    <img
      id="profile-img"
      src="./assets/img/bienmenu-long-logo.png"
      class="profile-img-card"
    />
    <div class="alert alert-danger" *ngIf="isOperationFailed">
      Failed to add restaurant...please try again or contact the system
      administrator.
    </div>
    <div class="alert alert-success" *ngIf="isSuccess">
      Restaurant added successfully
    </div>
    <form [formGroup]="restaurantForm" (ngSubmit)="onSubmit()">
      <div class="md-form">
        <mdb-icon fas icon="tag" class="prefix grey-text"></mdb-icon>
        <input
          type="text"
          id="name"
          formControlName="name"
          class="form-control"
          mdbInput
          mdbValidate
          required
        />
        <label for="name">Restaurant Name</label>
        <mdb-error *ngIf="name.invalid && (name.dirty || name.touched)">
          Restaurant name is required
        </mdb-error>
        <mdb-success *ngIf="name.valid && (name.dirty || name.touched)"
          >Valid
        </mdb-success>
      </div>
      <div class="md-form">
        <mdb-icon fas icon="city" class="prefix grey-text"></mdb-icon>
        <input
          type="text"
          id="city"
          formControlName="city"
          class="form-control"
          placeholder="Example: Montreal"
          mdbInput
          mdbValidate
        />
        <label for="city">City</label>
        <mdb-error *ngIf="city.invalid && (city.dirty || city.touched)">
          City is required and first letter must be capitalized
        </mdb-error>
        <mdb-success *ngIf="city.valid && (city.dirty || city.touched)">
          Valid
        </mdb-success>
      </div>
      <div class="md-form">
        <mdb-icon fas icon="map-marker" class="prefix grey-text"></mdb-icon>
        <input
          type="text"
          id="address"
          placeholder="Example: 123, Fake Blvd, A1B 2C3"
          formControlName="address"
          class="form-control"
          mdbInput
          mdbValidate
        />
        <label for="address">Address</label>
        <mdb-error
          *ngIf="address.invalid && (address.dirty || address.touched)"
        >
          Address is required, must follow the format street-number street-name
          postal-code
        </mdb-error>
        <mdb-success
          *ngIf="address.valid && (address.dirty || address.touched)"
        >
          Valid
        </mdb-success>
      </div>
      <div class="md-form">
        <h4>Menus</h4>
      </div>
      <div
        formArrayName="menus"
        *ngFor="
          let menu of restaurantForm.get('menus')['controls'];
          let i = index
        "
      >
        <div class="md-form">
          <div [formGroupName]="i">
            <div class="md-form">
              <mdb-icon fas icon="bars" class="prefix grey-text"></mdb-icon>
              <input
                type="text"
                id="name"
                formControlName="name"
                placeholder="Example: Main Menu / Menu Principal"
                required
                class="form-control"
                mdbInput
                mdbValidate
              />
              <label for="name">Menu Name</label>
              <mdb-error
                *ngIf="
                  menu.controls.name.invalid &&
                  (menu.controls.name.dirty || menu.controls.name.touched)
                "
              >
                Menu name is required
              </mdb-error>
              <mdb-success
                *ngIf="
                  menu.controls.name.valid &&
                  (menu.controls.name.dirty || menu.controls.name.touched)
                "
              >
                Valid
              </mdb-success>
            </div>
            <div class="md-form">
              <mdb-icon
                fas
                icon="file-signature"
                class="prefix grey-text"
              ></mdb-icon>
              <input
                type="text"
                id="filename"
                formControlName="filename"
                placeholder="Example: main_menu"
                required
                class="form-control"
                mdbInput
                mdbValidate
              />
              <label for="filename">Menu Filename</label>
              <mdb-error
                *ngIf="
                  menu.controls.filename.invalid &&
                  (menu.controls.filename.dirty ||
                    menu.controls.filename.touched)
                "
              >
                Filename is required and must only contain small letters,
                numbers or '_'
              </mdb-error>
              <mdb-success
                *ngIf="
                  menu.controls.filename.valid &&
                  (menu.controls.filename.dirty ||
                    menu.controls.filename.touched)
                "
              >
                Valid
              </mdb-success>
            </div>
            <!-- <div class="md-form">
              <mdb-icon fas icon="file-pdf" class="prefix grey-text"></mdb-icon>
              <input
                type="file"
                (change)="handleInputFiles($event.target.files, i)"
                required
              />
            </div> -->
            <button
              type="button"
              mat-raised-button
              (click)="deleteMenu(i)"
              class="delete-btn btn"
            >
              Remove Menu
            </button>
          </div>

          <!-- <div class="alert alert-danger" *ngIf="!isValidFile">
            Each file must not exceed 5 MB and must be in PDF format...
          </div> -->
        </div>
      </div>
      <button type="button" mat-raised-button (click)="addMenu()">
        Add Menu
      </button>

      <div class="md-form">
        <mdb-icon fas icon="file-pdf" class="prefix grey-text"></mdb-icon>
        <input
          type="file"
          multiple
          (change)="handleInputFiles($event.target.files)"
          required
        />
        <div class="divider"></div>
        <div class="alert alert-danger" *ngIf="!isValidFile">
          Files must be less than 5 MB, must be in PDF format, and cannot have
          duplicate names.
        </div>
        <div class="alert alert-danger" *ngIf="!menusMatchFiles">
          Please ensure that the number of files uploaded match with the menus
          you have added 1 to 1
        </div>
        <div class="divider"></div>
        <div class="card">
          <div class="card-header">Menu Files</div>

          <ul
            class="list-group list-group-flush"
            *ngFor="let file of menuFiles"
          >
            <li
              class="list-group-item d-flex justify-content-between align-items-center"
            >
              {{ file.name }}
              <button
                type="button"
                mat-raised-button
                class="delete-btn btn"
                (click)="deleteFile(file.name)"
              >
                x
              </button>
            </li>
          </ul>
        </div>
      </div>

      <div class="md-form">
        <mdb-icon fas icon="palette" class="prefix grey-text"></mdb-icon>
        <input
          type="text"
          id="color"
          formControlName="color"
          class="form-control"
          placeholder="An optional unique color for your menu viewer"
          mdbInput
          mdbValidate
        />
        <label for="color">Custom Color</label>
        <mdb-error *ngIf="color.invalid && (color.dirty || color.touched)">
          Colour must be in hex format, for example try #009688
        </mdb-error>
        <mdb-success *ngIf="color.valid && (color.dirty || color.touched)">
          Valid
        </mdb-success>
      </div>
      <button
        type="submit"
        mat-raised-button
        [disabled]="!restaurantForm.valid"
      >
        Submit
      </button>
    </form>
    <!-- <p>Form Value: {{ restaurantForm.value | json }}</p>

    <p>Form Status: {{ restaurantForm.status }}</p> -->
  </div>
</div>
